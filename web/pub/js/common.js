(function(){var e,t=this,n=[].slice;e=window,e.ck=CoffeeKup,e.wait=function(e,t){return setTimeout(t,e)},e.doEvery=function(e,t){return setInterval(t,e)},e.logging=!0,e.log=function(){var t;t=1<=arguments.length?n.call(arguments,0):[];if(e.logging)return typeof console!="undefined"&&console!==null?console.log.apply(console,t):void 0},window.module=function(e,t,r){var i,s,o,u,a,f;arguments.length<3&&(a=[typeof exports!="undefined"?exports:window].concat(n.call(arguments)),e=a[0],t=a[1],r=a[2]),s=e,f=t.split(".");for(o=0,u=f.length;o<u;o++)i=f[o],e=e[i]||(e[i]={});return r(e,s)}}).call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};module("BB",function(e,r){var i,s,o,u,a;return a=function(e,t,n){return console.log("emitting sync: ",t.syncName,e,t,n),window.sock.emit("api",t.syncName,{method:e,model:t,options:n},function(e,t){return console.log(e,t),e?n.error(t):n.success(t)})},s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.idAttribute="_id",n}(Backbone.Model),i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.getByIds=function(e){return this.filter(function(t){var r;return r=t.id,n.call(e,r)>=0})},r}(Backbone.Collection),s.prototype.sync=i.prototype.sync=a,u=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.open=function(e){return e==null&&(e=".main-cont"),this.$el.appendTo(e),this.trigger("open",e),this.isOpen=!0,this},n.prototype.close=function(){return this.unbind(),this.remove(),this.trigger("close"),this.isOpen=!1,this},n.prototype.render=function(){return this.$el.html(ck.render(this.template,this)),this},n}(Backbone.View),o=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.clearViews=function(e){var t,r,i,s;_.isArray(e)||(e=[e]),i=this.views,s=[];for(t in i)r=i[t],n.call(e,t)>=0||s.push(r.close());return s},r}(Backbone.Router),_.extend(e,{Model:s,Collection:i,View:u,Router:o})})}.call(this),function(){(function(e){return e.fn.center=function(){return this.css("position","absolute"),this.css("top",Math.max(0,(e(window).height()-this.outerHeight())/2+e(window).scrollTop())+"px"),this.css("left",Math.max(0,(e(window).width()-this.outerWidth())/2+e(window).scrollLeft())+"px"),this}})(jQuery)}.call(this),function(){module("App.Utils",function(e,t){var n;return n=function(){function e(){}return e.toHex=function(e){var t,n,r,i,s;n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],i="",s=!0,r=32;while(r>0){r-=4,t=e>>r&15;if(!s||t!==0)s=!1,i+=n[t]}return i===""?"0":i},e}(),e.Encode=n})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};module("BB.UI",function(e,r){var i,s;return i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(BB.Model),s={},s.Tags=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.tagName="div",r.prototype.className="ui-tags",r.prototype.initialize=function(e){return this.options=e!=null?e:{},_.defaults(this.options,{tags:[],typeahead:["one","two","three","four"]}),this.reset(this.options.tags)},r.prototype.tagsTemplate=function(){var e,t,n,r,i;span({"class":"icon-tags pull-left"}),r=this.getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(span(".tag",e));return i},r.prototype.renderTags=function(){return this.$(".ui-tags-cont").html(ck.render(this.tagsTemplate,this))},r.prototype.template=function(){return span({"class":"ui-tags-cont tags-list"},function(){}),span({"class":"ui-tag-entry"},function(){return input({type:"text","class":"tag-input input-small","data-provide":"typeahead",placeholder:"+ tag"})})},r.prototype.isValidTag=function(e){return!(n.call(this._tags,e)>=0)&&e.trim()!==""},r.prototype.events=function(){return{"keydown input":function(e){var t,n,r;if((n=e.which)===9||n===13||n===188)e.preventDefault(),this.isValidTag(t=$(e.currentTarget).val().trim())&&this.addTag(t);if((r=e.which)===8||r===46)if($(e.currentTarget).val()==="")return e.preventDefault(),this.removeLastTag()},"change input":function(e){var t;if(this.isValidTag(t=$(e.currentTarget).val().trim()))return this.addTag($(e.currentTarget).val())}}},r.prototype.addTag=function(e){return this._tags.push(e),this.renderTags(),this.trigger("change",this.getArray(),this.getString()),this.$("input").val("").focus(),this},r.prototype.removeLastTag=function(){var e;return e=this._tags.pop(),this.renderTags(),this.trigger("change",this.getArray(),this.getString()),this.$("input").val("").focus(),this},r.prototype.getArray=function(){return this._tags},r.prototype.getString=function(){return this._tags.join("|")},r.prototype.reset=function(e){var t;_.isString(e)&&(this._tags=e===""?[]:(t=e.split("|"))!=null?t:[]);if(_.isArray(e))return this._tags=e!=null?e:[]},r.prototype.render=function(){return this.$el.html(ck.render(this.template,this)),this.$("input").typeahead({source:this.options.typeahead}),this.renderTags(),this},r}(BB.View),s.Loading=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="loading-view",n.prototype.tagName="div",n.prototype.initialize=function(e){var t=this;return this.options=e!=null?e:{},_.defaults(this.options,{loadingText:"Loading..."}),console.log(this.options.loadingText),this.on("open",function(){return t.$(".view-cont").center()})},n.prototype.template=function(){return div({"class":"view-cont"},function(){return div({"class":"spinner-cont"}),h2({"class":"loading-text"},this.loadingText)})},n.prototype.render=function(){return this.$el.html(ck.render(this.template,this.options)),this.spinner=(new Spinner({top:"0px",left:"0px"})).spin(this.$(".spinner-cont")[0]),this},n.prototype.close=function(){var e=this;return this.$el.fadeOut("fast",function(){return e.spinner.stop(),n.__super__.close.call(e)})},n}(BB.View),_.extend(e,{State:i,Views:s})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};module("App.Activity",function(e,n){var r,i,s,o;return i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.syncName="activity",n}(BB.Model),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.syncName="activity",n.prototype.model=i,n}(BB.Collection),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(BB.Router),o={},o.Edit=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="div",n.prototype.className="activity-detail row-fluid",n.prototype.template=function(){return div({"class":"span5 left-cont"},function(){}),div({"class":"span7 right-cont"},function(){})},n}(BB.View),_.extend(e,{Model:i,Collection:r,Router:s,Views:o})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};module("App",function(e,n){var r,i,s;return r=function(){function e(){var e,t=this;this.loadingView=new BB.UI.Views.Loading,this.loadingView.render().open(),(e=window.filepicker)!=null&&e.setKey("Ag4e6fVtyRNWgXY2t3Dccz"),this.socketConnect(),this.data={},this.views={},this.connection.on("connect",function(e){return console.log("socket connected: ",e),t.connection.emit("handshake",function(e,n){return t.handshake=n,t.routers={main:new i({data:t.data,views:t.views}),media:new App.Media.Router({data:t.data,views:t.views})},Backbone.History.started||Backbone.history.start(),t.loadingView.close()}),t.connection.on("api",function(e,n){var r;return(r=t.data[e])!=null?r.dbEvent(n):void 0})})}return e.prototype.socketConnect=function(){return this.connection=window.sock=window.io.connect("/"),this},e}(),_.extend(e,{Router:i,Model:r,Views:s={}}),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(e){return this.options=e,_.extend(this,this.options)},n.prototype.routes={"":"begin"},n.prototype.begin=function(){return console.log("begin")},n}(BB.Router)}),$(function(){return window.app=new App.Model,window.sock.on("api",function(e,t){return console.log("event from api: ",e,t)}),console.log("ready!")})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=function(e,t){return function(){return e.apply(t,arguments)}};module("App.Media",function(e,r){var i,s,o,u;return s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.syncName="media",n.prototype.progress=function(){return parseInt(this.get("progress"),10)},n.prototype.thumbnailSrc=function(){return this.progress()<100?"http://lorempixel.com/400/300/abstract/2/PROCESSING%20VIDEO/":""+CFG.S3.URL_ROOT+CFG.S3.MEDIA_BUCKET+"/"+this.get("urlBase")+"_0004.png"},n.prototype.urlBase=function(){return""+App.Utils.Encode.toHex(this.get("fpData").url)},n}(BB.Model),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.syncName="media",n.prototype.model=s,n.prototype.dbEvent=function(e){var t,n,r,i;t=e.event,r=e.model,i=e.progress;if(t==="progress")return n=this.get(r._id),n.set("progress",i),console.log("updated: ",n)},n}(BB.Collection),o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(e){return this.options=e,_.extend(this,this.options),this.data.media=new i},n.prototype.routes={media:"list"},n.prototype.list=function(){var e=this;return this.clearViews(),this.views.list=new u.List({collection:this.data.media}),this.data.media.fetch({success:function(){return e.views.list.open()}})},n}(BB.Router),u={},u.IconItem=function(e){function r(){return this.updateProgress=n(this.updateProgress,this),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.tagName="li",r.prototype.className="span3 media-icon-item",r.prototype.initialize=function(){return this.model.on("change:progress",this.updateProgress)},r.prototype.events={"click .delete":function(){return this.model.destroy()}},r.prototype.updateProgress=function(){return this.model.progress()<100?this.$(".bar").css("width",""+this.model.progress()+"%"):this.render()},r.prototype.template=function(){return span({"class":"thumbnail"},function(){return img({src:""+this.model.thumbnailSrc()}),this.model.progress()<100&&div({"class":"progress progress-striped active progress-warning",style:"height:10px"},function(){return div({"class":"bar",style:"width: "+this.model.progress()+"%"})}),div({"class":"caption"},function(){return a({href:"#media/"+this.model.id},""+this.model.get("title")),span({"class":"icon-trash delete"})})})},r}(BB.View),u.List=function(e){function r(){return this.createFromUpload=n(this.createFromUpload,this),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.tagName="div",r.prototype.className="media-list",r.prototype.initialize=function(){var e=this;return this.collection.on("reset",function(){return e.render()}),this.collection.on("add",function(){return e.render()}),this.collection.on("remove",function(){return e.render()})},r.prototype.events={"click .upload-file":function(){var e;return e={metadata:!0},filepicker.getFile("*/*",e,this.createFromUpload)}},r.prototype.createFromUpload=function(e,t){var n;return n=prompt("Please enter a name for your media:",t.filename),this.collection.create({fpData:t,fpUrl:e,title:n},{wait:!0})},r.prototype.template=function(){return div({"class":"btn-group"},function(){return button({"class":"btn upload-file"},"upload file")}),ul({"class":"thumbnails"},function(){})},r.prototype.render=function(){var e,t,n,i,s;r.__super__.render.call(this),s=this.collection.models;for(n=0,i=s.length;n<i;n++)e=s[n],t=new u.IconItem({model:e}),t.render().open(this.$(".thumbnails"));return this},r}(BB.View),_.extend(e,{Model:s,Collection:i,Router:o,Views:u})})}.call(this)